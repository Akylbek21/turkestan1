<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="doc-title">Place ‚Äî Turkestan Guide</title>
<link rel="stylesheet" href="../css/main.css"/>
</head>
<body>
<header>
  <div class="container" style="display:flex;gap:10px;align-items:center">
    <a href="../index.html" class="badge" style="text-decoration:none">‚Üê Home</a>
    <h1 id="title">Place</h1>
  </div>
</header>

<img class="place-hero" alt="">
<main class="main">
  <div class="loc" id="loc"></div>
  <p class="lead" id="lead"></p>

  <div class="actions">
    <button class="btn primary" id="mark" type="button">I was here</button>
    <a class="btn" id="map" target="_blank" rel="noopener">Open in Google Maps</a>
    <button class="btn" id="share" type="button">Share</button>
  </div>

  <section class="section">
    <h3>Interesting facts</h3>
    <ul id="facts"></ul>
  </section>

  <section class="section quiz">
    <h3>Check your knowledge</h3>
    <div id="quiz"></div>
    <div class="actions"><button class="btn" id="check" type="button">Check</button></div>
  </section>

  <section class="recon" aria-label="Past / Today">
    <div class="recon-head">
      <h3 style="margin:0">Past / Today</h3>
      <small class="muted">Drag the slider</small>
    </div>
    <div class="recon-wrap">
      <img class="recon-img" alt="Today">
      <div class="recon-overlay"><img id="recon-then" alt="Past"></div>
      <input id="recon-slider" class="recon-slider" type="range" min="0" max="100" value="50"/>
    </div>
  </section>
</main>

<footer>
  <div class="container">¬© <span id="y"></span> Turkestan Guide</div>
</footer>

<!-- === –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –æ–±—ä–µ–∫—Ç window.PLACE –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 2 –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ id === -->
<script>
window.PLACE={
  id:'jibek-joly-park',
  name:'J—ñbek Joly Amusement Park',
  loc:'City center',
  category:'–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
  img:'../img/jibek-joly-park.webp',
  lead:'Family-friendly rides from gentle carousels to a Ferris wheel; food courts and weekend shows.',
  facts:[
    'Attractions for kids and adults.',
    'Evening lights create a festive mood.',
    'Seasonal events and fair stalls.'
  ],
  questions:[
    {q:'A signature attraction here is‚Ä¶', a:['Ferris wheel','Bobsleigh track','Underground mine'], ok:0},
    {q:'The park suits‚Ä¶', a:['Families and groups','Only professional athletes','Deep-sea divers'], ok:0}
  ]
};
</script>

<script>
/* Generic renderer (EN) */
document.addEventListener('DOMContentLoaded',()=>{
  const P=window.PLACE||{};
  const $=(s,r=document)=>r.querySelector(s);

  const y=$('#y'); if(y) y.textContent=new Date().getFullYear();

  const h1=$('#title'); const doc=$('#doc-title');
  h1&&(h1.textContent=P.name||'Untitled');
  doc&&(doc.textContent=(P.name?P.name+' ‚Äî ':'')+'Turkestan Guide');

  const loc=$('#loc'); loc&&(loc.textContent=P.loc||'');
  const lead=$('#lead'); lead&&(lead.textContent=P.lead||'');

  const cover=$('.place-hero');
  if(cover){
    const src=P.img||('../img/'+(P.id||'placeholder')+'.webp');
    cover.src=src; cover.alt=P.name||'';
    cover.onerror=()=>{ cover.style.display='none'; };
  }

  const facts=$('#facts');
  if(facts && Array.isArray(P.facts)){
    facts.innerHTML=P.facts.map(t=>`<li>‚úÖ ${escapeHtml(t)}</li>`).join('');
  }

  const quiz=$('#quiz');
  if(quiz && Array.isArray(P.questions)){
    quiz.innerHTML=P.questions.map((q,i)=>`
      <div class="q" data-i="${i}">
        <h4 style="margin:0 0 6px">${escapeHtml(q.q)}</h4>
        ${q.a.map((opt,idx)=>`<label style="display:block;margin:6px 0"><input type="radio" name="q${i}" value="${idx}"> ${escapeHtml(opt)}</label>`).join('')}
        <div class="muted res" style="margin-top:6px"></div>
      </div>`).join('');
    const btn=$('#check');
    btn&&btn.addEventListener('click',()=>{
      quiz.querySelectorAll('.q').forEach(box=>{
        const i=+box.dataset.i, ok=(P.questions[i].ok|0);
        const picked=box.querySelector('input[type=radio]:checked');
        const res=box.querySelector('.res');
        if(!picked){res.textContent='Choose an option';return;}
        res.textContent=(+picked.value===ok)?'Correct! üéâ':'Not quite. Try again.';
      });
    });
  }

  const map=$('#map');
  map&&(map.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent((P.name||'')+' '+(P.loc||'Turkestan region'))}`);

  // Hide recon block by default (no images yet)
  const recon=document.querySelector('.recon'); if(recon) recon.style.display='none';

  function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}
});
</script>
<script>
/* Bridge: sync "I was here" with Passport (visited + passport_log) */
(function () {
  const ID   = (window.PLACE && window.PLACE.id) || null;
  const mark = document.getElementById('mark');
  if (!ID || !mark) return;

  const VIS_KEY = 'visited';      // –æ–±—ä–µ–∫—Ç: { [id]: timestamp }
  const LOG_KEY = 'passport_log'; // –º–∞—Å—Å–∏–≤: [{id, date}]

  const readJSON  = (k, d)=>{ try{ const s=localStorage.getItem(k); return s?JSON.parse(s):d; }catch{ return d; } };
  const writeJSON = (k, v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} };

  function isVisited(id){
    const v = readJSON(VIS_KEY, {});
    return !!v[id];
  }
  function setVisited(id, on){
    const v = readJSON(VIS_KEY, {});
    if (on) v[id] = Date.now(); else delete v[id];
    writeJSON(VIS_KEY, v);

    let log = readJSON(LOG_KEY, []);
    if (on){
      if (!log.find(x => x.id === id)) log.push({ id, date: Date.now() });
    } else {
      log = log.filter(x => x.id !== id);
    }
    writeJSON(LOG_KEY, log);
  }
  function syncUI(){
    const on = isVisited(ID);
    mark.dataset.on = on ? '1' : '';
    // i18n-—Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –∞–Ω–≥–ª.
    const base = (window.I18N && I18N.t) ? I18N.t('place.mark') : 'I was here';
    mark.textContent = on ? (base + ' ‚úì') : base;
  }

  mark.addEventListener('click', () => {
    const on = isVisited(ID);
    setVisited(ID, !on);
    syncUI();
    // –û–±–Ω–æ–≤–∏–º –±–µ–π–¥–∂ –Ω–∞ –∏–Ω–¥–µ–∫—Å–Ω–æ–π, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –≤ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ
    if (window.updateVisitedBadge) {
      try {
        const total = Object.keys(readJSON(VIS_KEY, {})).length;
        updateVisitedBadge(total);
      } catch {}
    }
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  syncUI();
})();
</script>

<script src="../js/place-page.js" defer></script>
</body>
</html>
